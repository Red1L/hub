{"version":3,"sources":["modules/controllers/component-details.ts"],"names":[],"mappings":"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","file":"modules/controllers/component-details.js","sourcesContent":["/*\n * Copyright (c) 2015-2016, The SeedStack authors <http://seedstack.org>\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\nimport module = require('./module');\nimport angular = require(\"{angular}/angular\");\nimport IResource = angular.resource.IResource;\nimport IHttpService = angular.IHttpService;\n\nenum SubView {\n    IDENTITY = <any> 'identity'\n}\n\nfunction displayDocName() {\n    return function (input) {\n        return input.split('/').pop();\n    };\n}\n\nclass ComponentDetailsController {\n    public component:any;\n    public detailsView:SubView;\n\n    static $inject = ['HomeService', '$routeParams', '$http', '$mdToast', '$mdDialog', '$mdMedia'];\n\n    constructor(private api:any, private $routeParams:any, private $http:IHttpService, private $mdToast, private $mdDialog, private $mdMedia) {\n\n        this.detailsView = SubView.IDENTITY;\n\n        this.getComponent().$promise.then((component:any) => {\n            this.component = component;\n        });\n    }\n\n    public getComponent():IResource {\n        return this.api('home').enter('component', {componentId: this.$routeParams.id}).get();\n    }\n\n    public rateComponent(component):void {\n        if (component.isStarred) {\n            this.unStarComponent(component);\n        } else {\n            this.starComponent(component);\n        }\n    }\n\n    private starComponent(component):void {\n        component.$links('star').save(() => {\n            component.isStarred = true;\n            component.stars++;\n        }, (reject) => {\n            throw new Error(reject);\n        });\n    }\n\n    private unStarComponent(component):void {\n        component.$links('star').delete(() => {\n            component.isStarred = false;\n            if (component.stars > 0) {\n                component.stars--;\n            }\n        }, (reject) => {\n            throw new Error(reject);\n        })\n    }\n\n    private toast(message:string) {\n        this.$mdToast.show(\n            this.$mdToast.simple()\n                .textContent(message)\n                .position('top right')\n                .hideDelay(3000)\n        );\n    }\n\n    public syncComponent(component):void {\n        this.$mdDialog.show({\n            templateUrl: require.toUrl('{hub}/views/templates/syncing.tmpl.html'),\n            parent: angular.element(document.body),\n            clickOutsideToClose: false,\n            fullscreen: this.$mdMedia('sm') || this.$mdMedia('xs')\n        });\n\n        component.$links('self', {}, {sync: {method: 'PUT'}})\n            .sync()\n            .$promise\n            .then(() => {\n                this.getComponent()\n                    .$promise\n                    .then((component:any) => {\n                        this.component = component;\n                        this.$mdDialog.hide();\n                        this.toast(component.name + ' has been synced!');\n                    })\n                    .catch(ComponentDetailsController.promiseRejected);\n            })\n            .catch(ComponentDetailsController.promiseRejected);\n    }\n\n    public archiveComponent(component):void {\n        component.$links('state', {}, {archive: {method: 'PUT'}})\n            .archive('ARCHIVED')\n            .$promise\n            .then(() => {\n                this.component.state = 'ARCHIVED';\n                this.toast(component.name + ' has been archived!');\n            })\n            .catch(ComponentDetailsController.promiseRejected);\n    }\n\n    public restoreComponent(component):void {\n        component.$links('state', {}, {restore: {method: 'PUT'}})\n            .restore('PUBLISHED')\n            .$promise\n            .then(() => {\n                this.component.state = 'PUBLISHED';\n                this.toast(component.name + ' has been restored!');\n            })\n            .catch(ComponentDetailsController.promiseRejected);\n    }\n\n    public activeWikiURL:any;\n    public activeWikiName:string;\n\n    public setWikiPage(wikiName:string):void {\n        this.activeWikiName = wikiName;\n        this.activeWikiURL = '/components/generator-w20/wiki/' + wikiName;\n    };\n\n    public static promiseRejected(reason):void {\n        throw new Error(reason.statusText || reason.data || reason);\n    }\n}\n\nangular\n    .module(module.angularModules)\n    .filter('displayDocName', displayDocName)\n    .controller('ComponentDetailsController', ComponentDetailsController);"],"sourceRoot":"/source/"}