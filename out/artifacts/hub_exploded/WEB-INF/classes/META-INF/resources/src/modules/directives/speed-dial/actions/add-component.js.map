{"version":3,"sources":["modules/directives/speed-dial/actions/add-component.ts"],"names":[],"mappings":"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","file":"modules/directives/speed-dial/actions/add-component.js","sourcesContent":["/*\n * Copyright (c) 2015-2016, The SeedStack authors <http://seedstack.org>\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\nimport module = require('../../module');\nimport angular = require('{angular}/angular');\n\nenum RepositoryType {\n    GIT = <any> 'GIT',\n    SVN = <any> 'SVN'\n}\n\ninterface IRepository {\n    vcs: RepositoryType;\n    url: string;\n}\n\nclass VcsUrlValidator implements ng.IDirective {\n    require:string = 'ngModel';\n    scope:any = {repository: '='};\n    link:ng.IDirectiveLinkFn = (scope:ng.IScope, element:ng.IAugmentedJQuery, attributes:ng.IAttributes, ngModel:ng.INgModelController) => {\n        ngModel.$validators['isRepoUrl'] = (modelValue, viewValue) => {\n            switch (scope['repository'].vcs) {\n                case RepositoryType.GIT:\n                    return /(?:git|ssh|https?|git@[\\w\\.]+):(?:\\/\\/)?[\\w\\.@:\\/~_-]+\\.git(?:\\/?|\\#[\\d\\w\\.\\-_]+?)$/.test(viewValue);\n                default:\n                    return true;\n            }\n        };\n        scope.$watch('repository', () => {\n            ngModel.$validate();\n        }, true);\n    };\n}\n\nclass AddComponentController {\n    public repositoryTypes:RepositoryType[] = [RepositoryType.GIT, RepositoryType.SVN];\n    public repository:IRepository = <any>{};\n    public promise:ng.resource.IResource<any>;\n    public failure:boolean = false;\n\n    static $inject = ['HomeService', '$mdDialog', '$httpParamSerializer'];\n\n    constructor(private api, private $mdDialog, private $httpParamSerializer) {\n        this.repository.vcs = this.repositoryTypes[0];\n        this.repository.url = '';\n    };\n\n    public cancel():void {\n        this.$mdDialog.cancel();\n    };\n\n    public confirm(repository:IRepository):void {\n        var action = {\n            save: {\n                method: 'POST',\n                headers: {\n                    \"Content-Type\": \"application/x-www-form-urlencoded\"\n                }\n            }\n        };\n        var formParam = this.$httpParamSerializer({'url': repository.url, 'vcs': repository.vcs});\n        this.promise = this.api('home').enter('components', {}, action).save({}, formParam);\n        this.promise.$promise\n            .then(newComponent => {\n                this.$mdDialog.hide(newComponent);\n            })\n            .catch(reason => {\n                this.failure = true;\n                throw new Error(reason.statusText);\n            });\n    };\n}\n\nangular\n    .module(module.angularModules)\n    .directive('vcsUrlValidator', DirectiveFactory.getFactoryFor<VcsUrlValidator>(VcsUrlValidator))\n    .controller('AddComponentController', AddComponentController);\n"],"sourceRoot":"/source/"}